\documentclass[a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{dirtree}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{float}
\usepackage[english]{babel}
\title{Human Intracranial Brain Observations Player \\ User Manual}
\author{\textsc{BONTEMPS Benjamin} \\ \textsc{CHATARD Benoît} \\ \textsc{GANNERIE Adrien}}
\lstset{
	frame = single,
	basicstyle = \footnotesize\ttfamily
}

\begin{document}
\maketitle
\begin{abstract}
This document is the user manual of the Human Intracranial Brain Observations Player (HiBoP). HiBoP is being developed by the Centre de Recherche en Neurosciences de Lyon (CRNL), with funds from the Human Brain Project (HBP) to visualize large datasets of intracranial electroencephalography (iEEG) data. This document was written for the 2.1.0 version of HiBoP.
\end{abstract}
\tableofcontents
\section{HiBoP project} \label{data}
\paragraph{} A \textbf{Project} links together anatomical and functional data from a set of patients. If you have an anatomical description of the patients (3D mesh of the brain, MRI and coordinates of the sites of the electrodes) and the respective iEEG data, you can visualize them in 4D (3D space + time). The first thing to do with HiBoP is to create or open a Project. This can be done within HiBoP (section \ref{UI}), but also using a third-party software which automatically generates the files and the hierarchy, such as the HiBoP Database Manager (appendix \ref{bddmanager}).
\paragraph{} On your Hard Drive, the Project consists of a folder with several subfolders (Figure \ref{projectDirectory}). Each file in this subfolder is encoded with the json format, and thus can be edited (at your own risks) using any text editor. However this is not recommended, as any coma missing may cause the file to be incorrectly interpreted.
\begin{figure}[H]
\framebox[\textwidth]{%
\begin{minipage}{0.9\textwidth}
\dirtree{%
	.1 ProjectName/.
	.2 ProjectName.settings.
	.2 Datasets/.
	.3 DatasetName.dataset.
	.3 ....
	.2 Groups/.
	.3 GroupName.group.
	.3 ....
	.2 Patients/.
	.3 PatientName.patient.
	.3 ....
	.2 Protocols/.
	.3 ProtocolName.prov.
	.3 ....
	.3 Icons/.
	.4 Icon1.png.
	.4 Icon2.jpg.
	.4 ....
	.2 Visualizations/.
	.3 VisualizationName.visualization.
	.3 ....
}
\end{minipage}
}
\caption{\label{projectDirectory}Project directory hierarchy}
\end{figure}
\subsection{Settings}
\paragraph{} The .settings file at the root of the projet folder describes some project settings (Figure \ref{projectSettings}). This file contains a default path for the anatomical data of the patients and a default path for the functional data (iEEG).
\begin{figure}[H]
\begin{lstlisting}
{
  "ID": "41001a8a-23a5-409b-8b87-099dbb727a18",
  "Name": "ProjectName",
  "PatientDatabase": "Y:/BrainVisaDB/Epilepsy",
  "LocalizerDatabase": "Y:/LOCA_DATABASE"
}
\end{lstlisting}
\caption{\label{projectSettings}Example project settings file}
\end{figure}
\subsection{Patients}
\paragraph{} This subfolder contains .patient files, which contains metadata of the patients and full paths towards anatomical files for each patient (Figure \ref{patientFile}). A 3D mesh can be a single mesh (only one file) or a left-right mesh (one file for the left part and one for the right part of the brain). These files are in GIfTI format (.gii). You can also provide aditional files to show MarsAtlas parcels (.gii), or a transformation file (to align the mesh and its respective MRI, .trm). The MRIs must be in the NIfTI-1 format (.nii). The implantations must be in the PTS format. The connectivities files are CCEP (amplitude / latencies) text files.
\begin{figure}[H]
\begin{lstlisting}
{
  "ID": "LYONNEURO_2013_CHAj",
  "Name": "CHAj",
  "Date": 2013,
  "Place": "LYONNEURO",
  "Brain": {
    "Meshes": [
      {
        "$type": "HBP.Data.Anatomy.LeftRightMesh, Assembly-CSharp",
        "ID": "bb1ee4e1-b96b-4973-814d-fb30c4d0d512",
        "Name": "Grey matter",
        "LeftHemisphere": "[...]/LYONNEURO_2013_CHAj_Left.gii",
        "RightHemisphere": "[...]/LYONNEURO_2013_CHAj_Right.gii",
        "LeftMarsAtlasHemisphere": "",
        "RightMarsAtlasHemisphere": "",
        "Transformation": "[...]/LYONNEURO_2013_CHAj.trm"
      }
    ],
    "MRIs": [
      {
        "Name": "Preimplantation",
        "File": "[...]/LYONNEURO_2013_CHAj.nii"
      }
    ],
    "Connectivities": [],
    "Implantations": [
      {
        "Name": "Patient",
        "File": "[...]/LYONNEURO_2013_CHAj.pts",
        "MarsAtlas": "[...]/LYONNEURO_2013_CHAj.csv"
      },
      {
        "Name": "MNI",
        "File": "[...]/LYONNEURO_2013_CHAj_MNI.pts",
        "MarsAtlas": "[...]/LYONNEURO_2013_CHAj.csv"
      }
    ],
    "Epilepsy": {
      "Type": 5
    }
  }
}
\end{lstlisting}
\caption{\label{patientFile}Example patient file}
\end{figure}
\subsection{Groups}
\paragraph{} This subfolder contains .group files, which are simple lists of patients (Figure \ref{groupFile}).
\begin{figure}[H]
\begin{lstlisting}
{
  "ID": "{813cbd0a-550c-40de-95c7-b387626f9a96}",
  "Name": "VISU",
  "Patients": [
    "Gre_2013_BONn",
    "Gre_2015_BARr",
    "LYONNEURO_2013_CARj",
    "LYONNEURO_2017_PECv",
    "Gre_2015_PATa",
    "LYONNEURO_2014_REId"
  ]
}
\end{lstlisting}
\caption{\label{groupFile}Example group file}
\end{figure}
\subsection{Protocols}
\paragraph{} This subfolder contains .prov files (Figure \ref{provFile}). The .prov extension stands for \textbf{protocol visualization}. Typically, a functional data file in HiBoP is a set of time series (one for each channel) with data for each sample from the beginning to the end of the recording session. Such data are stored in the .eeg/.eeg.ent\footnote{\label{ELAN}ELAN format – ELAN is freely available at http://elan.lyon.inserm.fr} files.
In addition, information about the events of the experimental paradigm is stored in .pos files : event codes occurred at specific samples (e.g. an event of type « 10 » occurred at sample 134567).
The .prov file instructs HiBoP on how to epoch the data based on the .pos file. The idea is to create blocs of epochs, each of them centered around a specific type of events, called \textbf{main events} (i.e. consider all events with code « 10 » and extract for each of them a window ranging from 200 ms before to 700 ms after that event). Prov files define the blocs you want to visualize (code of the main event), how you want to call them, how you want to sort epochs within a bloc, etc.
When you define a new bloc, you must specify the main event (its code) and you can specify secondary events. Secondary events are useful when you want to sort trials: say that the task shows a picture (of type 10 = faces, 20 = landscapes, or 30 = fruits) and that participants have to press one or two buttons to specify whether the picture shows a fruit (1 = « yes », 2 = « no »). You would create for instance a bloc with all epochs around an event of type « 10 » (faces) and sort those epochs according to reaction time (the latency of event 1 or 2 relative to event 10 within each epoch). To do that in HiBoP, you would specify a secondary event in the « face » bloc with type 1 and 2 (i.e. all events of type 1 or 2), then write the « sorting rule » C0L1: which means that you want to sort trials according to the code of the main event (here 10, so no sorting necessary), then for all ex-aequos epochs, use the relative latency of the secondary event (1 or 2, relative to the main event 10).
You could set the main event to 10 and 20 and 30 to include in your bloc « faces », « landscapes » and « fruits », then the « sorting rule » C0L1 would sort trials according to the main event code first (all faces, then all landscapes, then all fruits) and then, within a given category, sort according to reaction time (secondary event 1 and 2)
The baseline is used for the trial matrices, which can include a baseline correction. This baseline correction is described in preferences (section \ref{preferences}).
The rest of the .prov file is straightforward : you can ask HiBoP to show .png or .jpg files at specific latencies relative to the main event.
\begin{figure}[H]
\begin{lstlisting}
{
  "ID": "{9fd88c3e-ce7f-4c1c-83b1-f4d1edcbfe5a}",
  "Name": "LEC1",
  "Blocs": [
    {
      "IllustrationPath": "./Protocols/Icons/LEC1_SEM.jpg",
      "ID": "d3ce596a-8918-4ba1-829d-5aa73efe060e",
      "Name": "SEMAN",
      "Position": {
        "Row": 1,
        "Column": 1
      },
      "Sort": "C0L1",
      "Window": {
        "Start": -500.0,
        "End": 3500.0
      },
      "Baseline": {
        "Start": -200.0,
        "End": 0.0
      },
      "Events": [
        {
          "Name": "SEM",
          "Codes": [
            10
          ],
          "Type": 0
        },
        {
          "Name": "RESPONSE",
          "Codes": [
            1,
            2
          ],
          "Type": 1
        }
      ],
      "Scenario": {
        "Icons": [
          {
            "IllustrationPath": "./Protocols/Icons/LEC1_SEM.jpg",
            "Name": "PIC",
            "Window": {
              "Start": 0.0,
              "End": 2000.0
            }
          }
        ]
      }
    }
  ]
}
\end{lstlisting}
\caption{\label{provFile}Example prov file (one bloc of the LEC1 LOCA)}
\end{figure}
\subsection{Datasets}
\paragraph{} This subfolder contains .dataset files, which summarize and link together anatomical and functional data for a given cognitive task (Figure \ref{datasetFile}).
A dataset is a list of data information, each of them connecting one patient (and its anatomical data) with functional data (.eeg and .pos files) for a single experiment. Each data information can be normalized indepently from what is set in the preferences (see Section \ref{preferences} for detailed information about normalization).
\begin{figure}[H]
\begin{lstlisting}
{
  "ID": "{dfad2720-a0ec-49d8-b552-787f28c78c3b}",
  "Name": "VISU_dataset",
  "Protocol": "{9d12c695-7ce6-49d4-82d0-a9da12ba776a}",
  "Data": [
    {
      "Name": "alpha_beta",
      "Patient": "Gre_2013_BONn",
      "Measure": "EEG data",
      "EEG": "[...]/Gre_2013_BONn_VISU_f8f24_ds8_sm0.eeg",
      "POS": "[...]/Gre_2013_BONn_VISU_ds8.pos",
      "Normalization": 4
    },
    {
      "Name": "alpha_beta",
      "Patient": "Gre_2015_BARr",
      "Measure": "EEG data",
      "EEG": "[...]/GRE_2015_BARr_VISU_f8f24_ds16_sm0.eeg",
      "POS": "[...]/GRE_2015_BARr_VISU_ds16.pos",
      "Normalization": 4
    },
    {
      "Name": "alpha_beta",
      "Patient": "Gre_2014_MADl",
      "Measure": "EEG data",
      "EEG": "[...]/GRE_2014_MADl_VISU_f8f24_ds8_sm0.eeg",
      "POS": "[...]/GRE_2014_MADl_VISU_ds8.pos",
      "Normalization": 4
    }
  ]
}
\end{lstlisting}
\caption{\label{datasetFile}Example dataset file}
\end{figure}
\subsection{Visualizations}
\paragraph{} This subfolder contains .visualization files (Figure \ref{visualizationFile}), which describe the contents of a visualization: it is composed of patients and columns. Each column allow one to visualize either the anatomy of the chosen patients or iEEG data for a specific protocol/bloc/dataset/data. The also stores the configuration of the visualization or of a particular column or site.
\begin{figure}[H]
\begin{lstlisting}
{
  "ID": "25c11585-fb23-4c70-b4d3-504f9851da11",
  "Name": "Visualization",
  "Patients": [
    "Gre_2009_CHIm",
    "Gre_2009_MWAm",
    "LYONNEURO_2013_CARj",
    "LYONNEURO_2013_DUMp"
  ],
  "Configuration": {
    "Brain Color": 15,
    "Brain Cut Color": 14,
    "Colormap": 13,
    "Mesh Part": 2,
    "Mesh": "MNI",
    "MRI": "MNI",
    "Implantation": "MNI",
    "Edges": false,
    "Sites": false,
    "MRI Min": 0.0,
    "MRI Max": 1.0,
    "Camera Type": 0,
    "Cuts": [],
    "Views": []
  },
  "Columns": [
    {
      "Dataset": "{dfad2720-a0ec-49d8-b552-787f28c78c3b}",
      "Protocol": "{9d12c695-7ce6-49d4-82d0-a9da12ba776a}",
      "Bloc": "3916b0a0-7ebc-4934-94e5-2308bf511f7c",
      "Label": "alpha_beta",
      "Configuration": {
        "ConfigurationBySite": {},
        "Site Gain": 1.0,
        "Site Maximum Influence": 15.0,
        "Transparency": 0.8,
        "Span Min": 0.0,
        "Middle": 0.0,
        "Span Max": 0.0,
        "Regions Of Interest": []
      }
    }
  ]
}
\end{lstlisting}
\caption{\label{visualizationFile}Example visualization file}
\end{figure}
\section{HiBoP description}\label{UI}
\paragraph{} This section will describe in details how to use HiBoP to create a HiBoP project and how to visualize the iEEG data. To open HiBoP, double click on HiBoP.exe (for Windows; for Linux and MacOS, read the README.md file located next to the executable). If you have any doubt about what an interface element does, you can hover it for a second and a tooltip will appear telling you what it does.
\subsection{Preferences}\label{preferences}
\paragraph{} A lot of global parameters shared through all projects can be set using the preference menu (Figure \ref{preferencesUI}). These parameters are stored in a file located next to the HiBoP executable (GeneralSettings.txt).
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{Preferences.png}
\end{center}
\caption{\label{preferencesUI}Preferences}
\end{figure}
\begin{itemize}
\item \textbf{Default Name} : Default name for a new project
\item \textbf{Projects} : Default path to search for projects
\item \textbf{Patients} : Default path to patients database
\item \textbf{Localizers} : Default path to functional data
\item \textbf{Screenshots} : Default path to save screenshots
\item \textbf{Site name correction} : Change the name of a certain patern of site names (for instance "xp4" becomes "X'4")
\item \textbf{Automatic iEEG Update} : Update the iEEG values on the brain automatically if they are outdated
\item \textbf{Event position} : How to average the secondary events position
\item \textbf{Value} : How to average the values
\item \textbf{Type} : Show every matrices of a selected protocol or only blocs chosen in columns
\item \textbf{Smoothing} : Should the matrices be smoothed horizontally (to have a better resolution)
\item \textbf{Normalization by baseline} : The following formula is applied to each value $v$ $$v = \frac{v - \mu_{b}}{\sigma_{b}}$$ where $b$ is an array of the baseline values depending on this parameter, $\mu_b$ is their mean and $\sigma_b$ is their standard deviation
\item \textbf{Bloc format} : How the trial matrices should be displayed (parameters depend on this parameter, try yourself to see which one is better for you)
\item \textbf{Trial synchronization} : Should the matrices be synchronized when selecting specific trials
\item \textbf{Theme} : Theme of the software (light theme is still under development)
\item \textbf{Cut lines} : Should the cut lines appear on the cuts ?
\item \textbf{Hide curve when column hidden} : Should the curves of the hidden column appear ?
\end{itemize}
\subsection{Project management}
\subsubsection{Creating, opening and saving a project}
\paragraph{} When creating a new project, you have to specify the name of your new project, the location where it will be saved, the location of the anatomical database and the location of the functional database (Figure \ref{newProjectUI}). The two last fields are optional.
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{NewProject.png}
\end{center}
\caption{\label{newProjectUI}Create a new project}
\end{figure}
\paragraph{} In order to open a previously created project (Figure \ref{openProjectUI}), you have to tell where your projects are located. Once these are loaded, you can either double click on the project you want to open or select the project and then click on Open. You can also sort projects using specific parameters.
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{OpenProject.png}
\end{center}
\caption{\label{openProjectUI}Open a project}
\end{figure}
\paragraph{} If you want to save a project to a different location or with a different name than when it was open, you can use the "Save as" menu (Figure \ref{saveProjectUI}).
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{SaveAs.png}
\end{center}
\caption{\label{saveProjectUI}Save a project as}
\end{figure}
\paragraph{} All of these menus are located in the File menu at the top of the screen.
\subsubsection{Patients management}
\paragraph{} To add patients to the opened project, you have to use the patients manager (Figure \ref{patientGestionUI}). The window has two panels: the left panel displays all available patients in the database (found in the folder you specify at the top of the window) whereas the right panel displays patients added to this project. For each patient, numbers indicate the status of their respective anatomical data (Meshes, MRIs, Implantations and Connectivities). To add or remove patients, you can either select them in any list and use the arrows to add or remove them, or you can create new patients from scratch using the "+" button in the center. In order for the anatomical database to be correctly loaded, you have to use a specific hierarchy described in appendix \ref{bddhierarchy}.
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.3]{PatientGestion.png}
\end{center}
\caption{\label{patientGestionUI}Patients manager}
\end{figure}
\paragraph{} To edit any loaded patient, you can double click\footnote{The process of double clicking an item to edit it is common to most windows of HiBoP} on it. This will open the patient modifier window (Figure \ref{patientModifierUI}) which will allow you to edit anything concerning the metadata or the anatomical data of this patient. You can navigate between anatomical data types using the tabs in the middle of the window.
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{PatientModifier.png}
\end{center}
\caption{\label{patientModifierUI}Patient modifier}
\end{figure}
\paragraph{} If you want to add a mesh, you can use the "+" button located to the left; if you want to edit a mesh, you can double click the mesh item, and this will open a mesh modifier window (Figure \ref{meshModifierUI}) which will allow you to edit the path to the GIfTI files or to the transformation file.
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{MeshModifier.png}
\end{center}
\caption{\label{meshModifierUI}Mesh modifier}
\end{figure}
\paragraph{} As stated in section \ref{data}, you can also create groups of patients to add them more easily to the visualizations. This is done through the groups manager window (Figure \ref{groupGestionUI}). To create a new group, use the "+" button on the left. To remove existing groups, select the group(s) you want to remove, and use the "-" button on the left\footnote{The process of using "+" button to add and "-" button to remove is common to most windows of HiBoP}. Adding and removing patients from a group is very similar to the patients manager window (Figure \ref{groupModifierUI}).
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{GroupGestion.png}
\end{center}
\caption{\label{groupGestionUI}Groups manager}
\end{figure}
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.3]{GroupModifier.png}
\end{center}
\caption{\label{groupModifierUI}Group modifier}
\end{figure}
\subsubsection{Data management}
\paragraph{} First thing to do concerning data management is to create a protocol that will epoch the iEEG data. You can do that using the protocol manager window (Figure \ref{protocolGestionUI}). You can also import an existing .prov file to the project by using the "Import..." button on the bottom.
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{ProtocolGestion.png}
\end{center}
\caption{\label{protocolGestionUI}Protocols manager}
\end{figure}
\paragraph{} Editing a protocol consists of defining the blocs for this protocol. This is done with the protocol modifier window (Figure \ref{protocolModifierUI}). There are two types of blocs in a protocol: a main bloc (first column) will be used for metadata and main epoching, whereas a secondary bloc (second and third columns) will be used to epoch around a second or a third main event (this is used if you want to hide a pause between two important data). To create a new bloc, click on an empty box. To edit a bloc, double click on an existing bloc.
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.3]{ProtocolModifier.png}
\end{center}
\caption{\label{protocolModifierUI}Protocol modifier}
\end{figure}
\paragraph{} A bloc can be edited with the bloc modifier window (Figure \ref{blocModifierUI}). There you can specify the name, the sorting method, the window and the baseline window, as well as events and icons for the iconic scenario, which can be edited by double clicking on them. To add an illustration to the bloc, you can click on the icon placeholder in the general category.
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{BlocModifier.png}
\end{center}
\caption{\label{blocModifierUI}Bloc modifier}
\end{figure}
\paragraph{} When your protocols are correctly defined, you are ready to create your datasets. This will be done using the datasets manager window (Figure \ref{datasetGestionUI}).
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{DatasetGestion.png}
\end{center}
\caption{\label{datasetGestionUI}Datasets manager}
\end{figure}
\paragraph{} For a given dataset, you need to give it a name and assign a protocol. All the data included in this dataset will be epoched regarding the chosen protocol. With the dataset modifier window (Figure \ref{datasetModifierUI}), you can add and edit data information. Each data information has a little colored box which indicates the status of the data information : red means it is unsuable, whereas green means you can visualize it. You can click on this box to have more information about the data information.
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{DatasetModifier.png}
\end{center}
\caption{\label{datasetModifierUI}Dataset modifier}
\end{figure}
\paragraph{} A data information has a name and is linked to a patient. A single dataset can not have two data information with the same pair [name, patient]. In order to visualize different data from the same dataset in the same column of a visualization, you have to give them the same name (thus the two patients concerned by these data will be different). Then, you have to fill in the paths to the functional data files (.eeg and .pos). The label in front of the EEG file path corresponds to the label of the data you want to extract from the EEG file (usually, it is "EEG data"). You can also change how this particular data will be normalized (this overwrites the global parameter for normalization).
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{DataInfoModifier.png}
\end{center}
\caption{\label{dataInfoModifierUI}Data information modifier}
\end{figure}
\subsubsection{Visualizations management}
\paragraph{} When everything is set up, you can create visualizations. This is done using the visualization manager window (Figure \ref{visuGestionUI}).
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{VisualizationGestion.png}
\end{center}
\caption{\label{visuGestionUI}Visualizations manager}
\end{figure}
\paragraph{} A visualization has a name, patients and columns. To edit all of this information, you can use the visualization modifier window (Figure \ref{visuModifierUI}). To add patients to the visualization, use the arrows (same process than adding patients to the project). To add a column, click on the "+" button under the "Columns" panel. You can then edit the column by setting the name, the type (anatomy only or iEEG), the protocol, the bloc, the dataset and the data name to be used in this column. Do not forget that if multiple patients are added to the visualization, they must have at least one data information with the same name.
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.3]{VisualizationModifier.png}
\end{center}
\caption{\label{visuModifierUI}Visualization modifier}
\end{figure}
\paragraph{} Once your visualizations are ready to be displayed, you can select them and click the "Display" button.
\subsection{3D Visualization}
\paragraph{}
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.7]{GlobalUI.png}
\end{center}
\caption{\label{globalUI}HiBoP user interface}
\end{figure}
\paragraph{} The main user interface of HiBoP can be decomposed as follow (Figure \ref{globalUI}) :
\begin{itemize}
\item \textbf{1} - Main menu (data management, see section \ref{UI} for more information)
\item \textbf{2} - Toolbar (used to do actions on the 3D scene, more information in later sections)
\item \textbf{3} - Toolbar selector (to select which toolbar you want to use)
\item \textbf{4} - 3D visualization (main visualization window)
\item \textbf{5} - Graphs and trial matrices (precise information of iEEG data, see section \ref{graphs})
\item \textbf{6} - Cut panel (manage cuts, see section \ref{cuts})
\item \textbf{7} - Open visualizations (used to minimize or close open visualizations)
\end{itemize}
\paragraph{} Elements in parts 4, 5 and 6 can be resized using the black handlers betweens them. Columns of the 3D vizualisations can be moved by drag and dropping their labels at the top of the column. You can interact with the scene in many ways :
\begin{itemize}
\item Left click on a view to select the corresponding view / column / scene or left click on a site / on a ROI to select it.
\item Right click and drag to rotate the brain surface
\item Middle click and drag to translate the brain surface
\item Use the scroll wheel to control the zoom
\end{itemize}
\paragraph{} The left panel allows you to change between toolbars. Each toolbar has its own functions, which will be explained in more details in later sections.
\newline
\begin{minipage}{0.2\textwidth}
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.75]{ToolbarSelector.png}
\end{center}
\end{figure}
\end{minipage}
\begin{minipage}{0.5\textwidth}
\begin{itemize}
\item Scene settings
\item Display settings
\item iEEG settings
\item Timeline
\item Sites
\item Regions of Interest
\item CCEP
\item fMRI
\item Triangle eraser
\item Configuration
\end{itemize}
\end{minipage}
\subsubsection{Cuts}\label{cuts}
\paragraph{} Before getting into the toolbars, let's talk about cuts. Indeed, HiBoP allows you to cut the 3D mesh (using the MRI to fill the cut plane) with the right panel. To add a cut, click on the "Add cut" button. You can change parameters on the cut after clicking on it to open the parameters panel (Figure \ref{cut}). You can change its orientation (Axial, Coronal, Sagital or Custom), you can flip it (Axial, Coronal and Sagital) or set up a custom normal (Custom), you can change the position of the cut using the slider or the "+" and "-" buttons for more precision. To delete a cut, open the parameters panel and click on the little cross on the top-right of the cut.
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{Cut.png}
\end{center}
\caption{\label{cut}Cut parameters panel}
\end{figure}
\paragraph{} The following sections will explain the different functionalities of each toolbar.
\subsubsection{Scene settings}
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.35]{SceneSettings.png}
\end{center}
\end{figure}
\begin{itemize}
\item Display both parts, only the left part or only the right part of the selected mesh (only works for left-right meshes).
\item Display mars atlas on the mesh (only works if the mars atlas field of the mesh is filled).
\item Display the edges of the mesh.
\item Switch between the soft cut mode (keep everything behind a cut) and the hard cut mode (cut everything in front of a cut).
\item Change the colormap of the iEEG values.
\item Change the color of the brain.
\item Change the color of the cuts.
\item Change the threshold of the MRI values (contrast).
\item Change the mesh (MNI meshes are available no matter the number of patients, the patient meshes are only available if the patient is alone in the visualization).
\item Change the MRI (patient MRIs are only available if the patient is alone in the visualization).
\item Change the implantation (an implantation is available only if each patient of the visualization has an implantation with the same name)
\end{itemize}
\subsubsection{Display settings}
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.4]{DisplaySettings.png}
\end{center}
\end{figure}
\begin{itemize}
\item Add or remove a view (maximum 5 views).
\item Set up standard views (3 views with 3 different points of view).
\item Reset the camera position of the selected view.
\item Reset the size of the views (if resized using the handlers).
\item Automatic rotation of the brain (you can set the rotation speed with the slider).
\item Change the camera behaviour (T = trackball camera, O = orbital camera).
\item Take a raw screenshot of the scene which will be saved in the default screenshot directory (set in preferences).
\item Save the scene as files in a directory named after the name of the visualization in the default screenshot directory (one image per open view, one image per cut, one image and one svg for the graph, one image for the trial matrices, one csv for each curve containing the values).
\end{itemize}
\subsubsection{iEEG settings}
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.4]{iEEGSettings.png}
\end{center}
\end{figure}
\begin{itemize}
\item Trigger global mode (any changes will be applied to all columns)
\item Change the size of the sites
\item Change the size of the influence sphere of the sites (to compute the iEEG on the brain surface)
\item Change the transparency of the iEEG value on the brain surface
\item Change the threshold values for the iEEG (anything less than the minimum value will be of the same color as the minimum value, the same apply for the maximum value; the rest of the values will increase linearly from minimum to middle, then decrease linearly from middle to maximum).
\item Compute the iEEG values on the brain surface or clean the brain.
\end{itemize}
\subsubsection{Timeline}
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.4]{Timeline.png}
\end{center}
\end{figure}
\begin{itemize}
\item Trigger global mode (any changes will be applied to all columns).
\item Make the timeline play automatically.
\item Increase the current timeline ID by a specific amount of samples (this also controls the speed of the play, X samples will be played each second).
\item Loop the timeline (when playing automatically).
\item Slider to control the timeline precisely; the red mark indicates the main event, the blue marks indicates the secondary events (as defined in the .prov file).
\end{itemize}
\subsubsection{Sites}
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.4]{Sites.png}
\end{center}
\end{figure}
\begin{itemize}
\item Selected site name.
\item Display all sites in the scene.
\item Hide blacklisted sites.
\item Change the state of some sites (you can select which sites using filters). Available states are :
\begin{itemize}
\item Excluded : an excluded site is not in the iEEG computations, but it remains visible in the scene
\item Highlighted : a highlighted site appears without transparency in the scene
\item Marked : a marked site appears in another color when the iEEG are not computed (the behaviour is the same as an included site)
\item Blacklisted : a blacklisted site will be barely visible and not included in any calculation
\end{itemize}
\item Display a list of all sites with their respective state. Click on the name of a site to select it.
\item Compare two sites : select a site, click on this button, then select another site to compare them.
\item Load the single patient scene corresponding to the patient whose site is selected.
\item Cut approximately around the select site.
\item Copy the states of the sites of the selected column to every other columns.
\item Save the states of the sites in a .csv file.
\item Load a .csv file with the states of the sites to the selected column.
\end{itemize}
\subsubsection{Regions of Interest}
\paragraph{} Regions of Interest (ROI) are useful if you only want to study a small group of sites. They are composed of multiple spheres with different positions and radiuses. If the option "Show All Sites" of the sites toolbar is not enabled, only the sites of the selected ROI will be included in the iEEG computations on the brain. A curve will also be generated for the selected ROI of each column (section \ref{graphs}).
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.4]{ROI.png}
\end{center}
\end{figure}
\begin{itemize}
\item Add a new ROI in the selected column.
\item Select a ROI for the selected column.
\item Change the name of the selected ROI.
\item Remove the selected ROI.
\item Select a sphere of the ROI.
\item Delete the selected ROI.
\item Copy the selected ROI to other columns.
\item Save the selected ROI to a .roi file.
\item Load a .roi file to the selected column.
\end{itemize}
\subsubsection{CCEP}
\paragraph{} This toolbar will allow you to enable CCEP mode (which will disable iEEG mode) and choose from the Connectivity files which one you want to display. To select a source, simply select the site you want as source.
\subsubsection{fMRI}
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.4]{fMRI.png}
\end{center}
\end{figure}
\begin{itemize}
\item Add or remove a fMRI to the anatomic MRI. If iEEG values are computed, the fMRI will not be displayed.
\item Change the threshold values of the fMRI.
\item Change the transparency of the fMRI.
\end{itemize}
\subsubsection{Triangle eraser}
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.4]{TriEraser.png}
\end{center}
\end{figure}
\begin{itemize}
\item Reset the triangle eraser.
\item Choose how you want to erase triangles (one triangle, cylinder, zone).
\item Expand the erased zone.
\item Invert the erased zone.
\item Revert last action.
\end{itemize}
\subsubsection{Configuration}
\paragraph{} This toolbar allow you to save, load or reset the configuration of the selected scene. Beware, saving the configuration will just save it to the loaded visualization: to write the changes in the corresponding file, you still have to save the whole project.
\subsection{Graphs and Trial Matrices}\label{graphs}
\subsubsection{Graphs}
\subsubsection{Trial matrices}
\appendix
\section{HiBoP Database Manager}\label{bddmanager}
\section{HiBoP Database Hierarchy}\label{bddhierarchy}
\end{document}